function $(t){return document.getElementById(t)}var settings={width:1024,projection:"aitoff",transform:"equatorial",background:"#000",stars:{show:!0,limit:6,colors:!0,color:"#fff",names:!0,proper:!1,desig:!0,namelimit:2,data:"data/stars.6.json"},dsos:{show:!0,limit:6,names:!0,desig:!0,namelimit:4,data:"data/dsos.bright.json"},constellations:{show:!0,names:!0,desig:!0,lines:!0,bounds:!1},mw:{show:!0},lines:{graticule:!0,equatorial:!1,ecliptic:!0,galactic:!1,supergalactic:!1},set:function(t){var e,a,r={};if(!t)return this;for(e in this)if(this.hasOwnProperty(e)&&"function"!=typeof this[e])if(t.hasOwnProperty(e)&&null!==t[e])if(this[e].constructor!=Object)r[e]=t[e];else{r[e]={};for(a in this[e])r[e][a]=t[e].hasOwnProperty(a)?t[e][a]:this[e][a]}else r[e]=this[e];return r}},symbols={gg:{shape:"circle",stroke:"#f00",fill:"#f00"},g:{shape:"ellipse",stroke:"#f00",fill:"#f00"},s:{shape:"ellipse",stroke:"#f00",fill:"#f00"},s0:{shape:"ellipse",stroke:"#f00",fill:"#f00"},sd:{shape:"ellipse",stroke:"#f00",fill:"#f00"},e:{shape:"ellipse",stroke:"#f00",fill:"#f00"},i:{shape:"ellipse",stroke:"#f00",fill:"#f00"},oc:{shape:"circle",stroke:"#fc0",fill:"none"},gc:{shape:"circle",stroke:"#f90",fill:"#f90"},en:{shape:"square",stroke:"#f0c",fill:"#f0c"},bn:{shape:"square",stroke:"#f0c",fill:"none"},sfr:{shape:"square",stroke:"#c0f",fill:"none"},rn:{shape:"square",stroke:"#00f",fill:"#00f"},pn:{shape:"diamond",stroke:"#0cc",fill:"#0cc"},snr:{shape:"diamond",stroke:"#f0c",fill:"#f0c"},dn:{shape:"square",stroke:"#999",fill:"none"},pos:{shape:"marker",stroke:"#ccc",fill:"none"}},bvcolor=d3.scale.quantize().domain([3.347,-.335]).range(["#ff4700","#ff4b00","#ff4f00","#ff5300","#ff5600","#ff5900","#ff5b00","#ff5d00","#ff6000","#ff6300","#ff6500","#ff6700","#ff6900","#ff6b00","#ff6d00","#ff7000","#ff7300","#ff7500","#ff7800","#ff7a00","#ff7c00","#ff7e00","#ff8100","#ff8300","#ff8506","#ff870a","#ff8912","#ff8b1a","#ff8e21","#ff9127","#ff932c","#ff9631","#ff9836","#ff9a3c","#ff9d3f","#ffa148","#ffa34b","#ffa54f","#ffa753","#ffa957","#ffab5a","#ffad5e","#ffb165","#ffb269","#ffb46b","#ffb872","#ffb975","#ffbb78","#ffbe7e","#ffc184","#ffc489","#ffc78f","#ffc892","#ffc994","#ffcc99","#ffce9f","#ffd1a3","#ffd3a8","#ffd5ad","#ffd7b1","#ffd9b6","#ffdbba","#ffddbe","#ffdfc2","#ffe1c6","#ffe3ca","#ffe4ce","#ffe8d5","#ffe9d9","#ffebdc","#ffece0","#ffefe6","#fff0e9","#fff2ec","#fff4f2","#fff5f5","#fff6f8","#fff9fd","#fef9ff","#f9f6ff","#f6f4ff","#f3f2ff","#eff0ff","#ebeeff","#e9edff","#e6ebff","#e3e9ff","#e0e7ff","#dee6ff","#dce5ff","#d9e3ff","#d7e2ff","#d3e0ff","#c9d9ff","#bfd3ff","#b7ceff","#afc9ff","#a9c5ff","#a4c2ff","#9fbfff","#9bbcff"]),projections={airy:{arg:Math.PI/2,scale:360,ratio:1,clip:!0},aitoff:{arg:null,scale:162},armadillo:{arg:0,scale:250},august:{arg:null,scale:94,ratio:1.4},azimuthalEqualArea:{arg:null,scale:220,ratio:1,clip:!0},azimuthalEquidistant:{arg:null,scale:150,ratio:1,clip:!0},baker:{arg:null,scale:160,ratio:1.4},berghaus:{arg:1,scale:320,ratio:1,clip:!0},boggs:{arg:null,scale:170},bonne:{arg:Math.PI/4,scale:230,ratio:.88},bromley:{arg:null,scale:162},collignon:{arg:null,scale:100,ratio:2.6},craig:{arg:0,scale:310,ratio:1.5,clip:!0},craster:{arg:null,scale:160},cylindricalEqualArea:{arg:Math.PI/6,scale:180},cylindricalStereographic:{arg:Math.PI/4,scale:230,ratio:1.3},eckert1:{arg:null,scale:175},eckert2:{arg:null,scale:175},eckert3:{arg:null,scale:190},eckert4:{arg:null,scale:190},eckert5:{arg:null,scale:182},eckert6:{arg:null,scale:182},eisenlohr:{arg:null,scale:102},equirectangular:{arg:null,scale:160},fahey:{arg:null,scale:196,ratio:1.4},foucaut:{arg:null,scale:142},ginzburg4:{arg:null,scale:180,ratio:1.7},ginzburg5:{arg:null,scale:196,ratio:1.55},ginzburg6:{arg:null,scale:190,ratio:1.4},ginzburg8:{arg:null,scale:205,ratio:1.3},ginzburg9:{arg:null,scale:190,ratio:1.4},gringorten:{arg:null,scale:360,ratio:1,clip:!0},hammer:{arg:2,scale:180},hatano:{arg:null,scale:186},healpix:{arg:1,scale:300,ratio:1.2},hill:{arg:2,scale:190,ratio:1.6},homolosine:{arg:null,scale:160,ratio:2.2},kavrayskiy7:{arg:null,scale:185,ratio:1.75},lagrange:{arg:Math.PI/2,scale:88,ratio:1.7,clip:!0},larrivee:{arg:null,scale:160,ratio:1.25},laskowski:{arg:null,scale:165,ratio:1.7},loximuthal:{arg:Math.PI/4,scale:170,ratio:1.8},mercator:{arg:null,scale:160,ratio:1.3},miller:{arg:null,scale:160,ratio:1.5},mollweide:{arg:null,scale:180},mtFlatPolarParabolic:{arg:null,scale:175},mtFlatPolarQuartic:{arg:null,scale:230,ratio:1.65},mtFlatPolarSinusoidal:{arg:null,scale:175,ratio:1.9},naturalEarth:{arg:null,scale:185,ratio:1.85},nellHammer:{arg:null,scale:160,ratio:2.6},orthographic:{arg:null,scale:480,ratio:1,clip:!0},patterson:{arg:null,scale:160,ratio:1.75},polyconic:{arg:null,scale:160,ratio:1.3},rectangularPolyconic:{arg:0,scale:160,ratio:1.65},robinson:{arg:null,scale:160},sinusoidal:{arg:null,scale:160,ratio:2},stereographic:{arg:null,scale:480,ratio:1,clip:!0},times:{arg:null,scale:210,ratio:1.4},twoPointEquidistant:{arg:Math.PI/2,scale:320,ratio:1.15,clip:!0},vanDerGrinten:{arg:null,scale:160,ratio:1},vanDerGrinten2:{arg:null,scale:160,ratio:1},vanDerGrinten3:{arg:null,scale:160,ratio:1},vanDerGrinten4:{arg:null,scale:160,ratio:1.6},wagner4:{arg:null,scale:185},wagner6:{arg:null,scale:160},wagner7:{arg:null,scale:190,ratio:1.8},wiechel:{arg:null,scale:360,ratio:1,clip:!0},winkel3:{arg:null,scale:196,ratio:1.7}},Celestial={};Celestial.display=function(t){function e(t){return m.clip&&d3.geo.distance(k,t)>halfπ?0:1}function a(t){return"translate("+j(t)+")"}function r(){if(d3.event){var t=j.rotate();P.scale(j.scale()),v=7*Math.sqrt(j.scale()/m.scale),k=[-t[0],-t[1]],z.selectAll(".constname").attr("transform",function(t){return a(t.geometry.coordinates)}).style("fill-opacity",function(t){return e(t.geometry.coordinates)}),z.selectAll(".constline").attr("d",I),z.selectAll(".boundaryline").attr("d",I),z.selectAll(".star").attr("d",I.pointRadius(function(t){return t.properties?f(t.properties.mag):1})),z.selectAll(".starname").attr("transform",function(t){return a(t.geometry.coordinates)}).style("fill-opacity",function(t){return e(t.geometry.coordinates)}),z.selectAll(".dso").attr("transform",function(t){return a(t.geometry.coordinates)}).attr("d",function(t){return l(t.properties)}).style("fill-opacity",function(t){return e(t.geometry.coordinates)}).style("stroke-opacity",function(t){return e(t.geometry.coordinates)}),z.selectAll(".dsoname").attr("transform",function(t){return a(t.geometry.coordinates)}).style("fill-opacity",function(t){return e(t.geometry.coordinates)}),z.selectAll(".outline").attr("d",x),z.selectAll(".gridline").attr("d",I),z.selectAll(".mw").attr("d",I),z.selectAll(".ecliptic").attr("d",I),z.selectAll(".equatorial").attr("d",I),z.selectAll(".galactic").attr("d",I),z.selectAll(".supergalactic").attr("d",I)}}function l(t){var e=o(t.mag,t.dim)||9,a=n(t.type);return-1!==d3.svg.symbolTypes.indexOf(a)?d3.svg.symbol().type(a).size(e)():d3.svg.customSymbol().type(a).size(e)()}function n(t){return t&&symbols.hasOwnProperty(t)?symbols[t].shape:"circle"}function s(t,e){return!t.type||!symbols.hasOwnProperty(t.type)||999==t.mag&&Math.sqrt(parseInt(t.dim))<d.dsos.limit||999!=t.mag&&t.mag>d.dsos.limit?"":e?"fill:"+symbols[t.type].stroke:"stroke:"+symbols[t.type].stroke+"; fill:"+symbols[t.type].fill}function o(t,e){return t&&999!=t?Math.pow(2*v-t,1.4):Math.pow(parseInt(e)*v/7,.5)}function i(t){return 999==t.mag&&Math.sqrt(parseInt(t.dim))<d.dsos.namelimit||999!=t.mag&&t.mag>d.dsos.namelimit||""===t.name?void 0:d.dsos.desig&&t.desig?t.desig:t.name}function c(t){return t.mag>d.stars.namelimit||d.stars.desig===!1&&""===t.name?void 0:d.stars.proper&&""!==t.name?t.name:d.stars.desig?t.desig:void 0}function f(t){if(null===t)return.2;var e=v*Math.exp(w*(t+2));return e>.2?e:.2}function u(t){return t.mag>d.stars.limit?"rgba(0,0,0,0)":d.stars.colors?bvcolor(t.bv):d.stars.color}var d,g,p;if(d=settings.set(t),p=$("map")?"#map":"body",projections.hasOwnProperty(d.projection)){var m=projections[d.projection],h=d.transform||"equatorial",y=m.ratio||2,b=d.width,M=b/y,v=7,w=-.3,k="galactic"==h?[0,0,0]:[180,0,0],j=Celestial.projection(d.projection).rotate(eulerAngles[h]).translate([b/2,M/2]).scale([m.scale]),P=Celestial.projection(d.projection).translate([b/2,M/2]).scale([m.scale]);m.clip&&(j.clipAngle(90),g=d3.geo.circle().angle([90]));var A=d3.geo.zoom().projection(j).center([b/2,M/2]).scaleExtent([m.scale,4*m.scale]).on("zoom.redraw",r),q=d3.geo.graticule().minorStep([15,10]),I=d3.geo.path().projection(j),x=d3.geo.path().projection(P),z=d3.select(p).append("svg").attr("width",b).attr("height",M).call(A);g?z.append("path").datum(g).attr("class","outline").attr("d",x).style("fill",d.background):z.append("path").datum(q.outline).attr("class","outline").attr("d",x).style("fill",d.background),d.lines.graticule&&("equatorial"==h?z.append("path").datum(q).attr("class","gridline").attr("d",I):Celestial.graticule(z,I,h)),d.mw.show&&d3.json("data/mw.json",function(t,e){z.selectAll(".mway").data(e.features).enter().append("path").attr("class","mw").attr("d",I)}),d.constellations.show&&(d3.json("data/constellations.json",function(t,r){z.selectAll(".constnames").data(r.features).enter().append("text").attr("class","constname").attr("transform",function(t){return a(t.geometry.coordinates)}).text(function(t){return d.constellations.names?d.constellations.desig?t.properties.desig:t.properties.name:void 0}).style("fill-opacity",function(t){return e(t.geometry.coordinates)})}),d.constellations.bounds&&d3.json("data/constellations.bounds.json",function(t,e){z.selectAll(".bounds").data(e.features).enter().append("path").attr("class","boundaryline").attr("d",I)}),d.constellations.lines&&d3.json("data/constellations.lines.json",function(t,e){z.selectAll(".lines").data(e.features).enter().append("path").attr("class","constline").attr("d",I)})),d.stars.show&&d3.json(d.stars.data,function(t,r){z.selectAll(".stars").data(r.features).enter().append("path").attr("class","star").attr("d",I.pointRadius(function(t){return t.properties?f(t.properties.mag):1})).style("fill",function(t){return u(t.properties)}),d.stars.names&&z.selectAll(".starnames").data(r.features).enter().append("text").attr("transform",function(t){return a(t.geometry.coordinates)}).text(function(t){return c(t.properties)}).attr({dy:"-.5em",dx:".35em","class":"starname"}).style("fill-opacity",function(t){return e(t.geometry.coordinates)})}),d.dsos.show&&d3.json(d.dsos.data,function(t,r){z.selectAll(".dsos").data(r.features).enter().append("path").attr("class",function(t){return"dso "+t.properties.type}).attr("transform",function(t){return a(t.geometry.coordinates)}).attr("d",function(t){return l(t.properties)}).attr("style",function(t){return s(t.properties)}).style("fill-opacity",function(t){return e(t.geometry.coordinates)}).style("stroke-opacity",function(t){return e(t.geometry.coordinates)}),d.dsos.names&&z.selectAll(".dsonames").data(r.features).enter().append("text").attr("class",function(t){return"dsoname "+t.properties.type}).attr("transform",function(t){return a(t.geometry.coordinates)}).text(function(t){return i(t.properties)}).attr({dy:"-.5em",dx:".35em",style:function(t){return s(t.properties,!0)}}).style("fill-opacity",function(t){return e(t.geometry.coordinates)})});for(var C in d.lines)d.lines.hasOwnProperty(C)&&"graticule"!=C&&d.lines[C]!==!1&&z.append("path").datum(d3.geo.circle().angle([90]).origin(poles[C])).attr("class",C).attr("d",I)}},Celestial.projection=function(t){var e,a,r;if(!projections.hasOwnProperty(t))throw new Error("Projection not supported: "+t);return e=projections[t],a=null!==e.arg?d3.geo[t].raw(e.arg):d3.geo[t].raw,r=function(t,e){var r=a(-t,e);return r},r.invert=function(t,e){var r=a.invert(t,e);return r[0]*=-1,r},d3.geo.projection(r)};var eulerAngles={equatorial:[180,0,0],ecliptic:[180,0,23.4393],galactic:[93.5949,28.9362,-58.5988],supergalactic:[137.31,59.5283,57.7303]},poles={equatorial:[0,90],ecliptic:[-90,66.5607],galactic:[-167.1405,27.1283],supergalactic:[-76.2458,15.7089]},τ=2*Math.PI,halfπ=Math.PI/2,deg2rad=Math.PI/180;Celestial.graticule=function(t,e,a){var r;if(a&&"equatorial"!=a){for(r=10;170>=r;r+=10)t.append("path").datum(d3.geo.circle().angle([r]).origin(poles[a])).attr("class","gridline").attr("d",e);for(r=10;180>=r;r+=10)t.append("path").datum(d3.geo.circle().angle([90]).origin(Celestial.transformDeg([r,0],euler["inverse "+a]))).attr("class","gridline").attr("d",e)}},Celestial.transformDeg=function(t,e){var a=Celestial.transform(t.map(function(t){return t*deg2rad}),e);return a.map(function(t){return t/deg2rad})},Celestial.transform=function(t,e){var a,r,l,n,s,o,i,c,f,u,d=1e-5;return e?(o=t[0],0>o&&(o+=τ),i=t[1],o-=e[0],n=e[1],s=e[2],a=Math.sin(i)*Math.sin(n)-Math.cos(i)*Math.cos(n)*Math.cos(o),Math.abs(a)<d&&(a=-Math.cos(i+n)+Math.cos(i)*Math.cos(n)*(1-Math.cos(o))),r=-Math.cos(i)*Math.sin(o),c=0!==a||0!==r?Math.atan2(r,a):o-Math.PI,f=s+c,f>Math.PI&&(f-=τ),o%Math.PI===0?(u=i+Math.cos(o)*n,u>halfπ&&(u=Math.PI-u),-halfπ>u&&(u=-Math.PI-u)):(l=Math.sin(i)*Math.cos(n)+Math.cos(i)*Math.sin(n)*Math.cos(o),Math.abs(l)>.99?(u=Math.abs(Math.acos(Math.sqrt(a*a+r*r))),0>l&&(u*=-1)):u=Math.asin(l)),[f,u]):t};var euler={ecliptic:[270,23.4393,90],"inverse ecliptic":[90,23.4393,270],galactic:[192.8595,62.8717,122.9319],"inverse galactic":[238.9319,62.8717,192.8595],supergalactic:[283.7542,74.2911,26.4504],"inverse supergalactic":[334.4504,74.2911,283.7542],init:function(){for(var t in this)this[t].constructor==Array&&(this[t]=this[t].map(function(t){return t*deg2rad}))},add:function(t,e){return e&&t&&3===e.length&&!this.hasOwnProperty(t)?(this[t]=e.map(function(t){return t*deg2rad}),this[t]):void 0}};euler.init();var customSymbolTypes=d3.map({ellipse:function(t){var e=Math.sqrt(t),a=.666*e,r=e/3;return"M"+-a+","+-r+" m"+-a+",0 a"+a+","+r+" 0 1,0"+2*a+",0 a"+a+","+r+" 0 1,0"+-(2*a)+",0"},marker:function(t){var e=t>48?t/4:12,a=e/2,r=a-3;return"M "+-a+" 0 h "+r+" M 0 "+-a+" v "+r+" M "+a+" 0 h "+-r+" M 0 "+a+" v "+-r}});d3.svg.customSymbol=function(){function t(t,r){return customSymbolTypes.get(e.call(this,t,r))(a.call(this,t,r))}var e,a=64;return t.type=function(a){return arguments.length?(e=d3.functor(a),t):e},t.size=function(e){return arguments.length?(a=d3.functor(e),t):a},t};